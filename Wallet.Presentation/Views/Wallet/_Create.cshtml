@model Wallet.Shared.Contract.ViewModels.WalletVm.WalletVm

<form id="CreateWallet" class="w-100">
    <!-- ردیف اول -->
    <div class="row mb-3">
        <div class="col-md-6">
            <label for="Name" class="form-label">نام کیف پول</label>
            <input type="text" class="form-control shadow rounded-2 text-right" asp-for="Name">
        </div>

        <!-- تغییرات در این بخش -->
        <div class="col-md-6">
            <label for="SubSysId" class="form-label">نام شرکت</label>
            <!-- استفاده از تگ select برای نمایش لیست کشویی -->
            <select asp-for="SubSysId"
                    class="form-control shadow rounded-2 text-right"
                    asp-items="ViewBag.SubSystemList">
                <option value="">انتخاب کنید...</option>
            </select>
        </div>
        <!-- پایان تغییرات -->

    </div>
    <!-- ردیف دوم -->
    <div class="row mb-3">
        <div class="col-md-6">
            <label for="Balance" class="form-label">موجودی</label>
            <input type="number" class="form-control shadow rounded-2 text-right" asp-for="Balance">
        </div>
        <div class="col-md-6">
            <label for="SaveDate" class="form-label">تاریخ</label>
            <input type="text" class="form-control shadow rounded-2 text-right" asp-for="SaveDate">
        </div>
    </div>
    <div class="row">
        <div class="col-12 text-center d-flex justify-content-center gap-2">
            <!-- دکمه ثبت -->
            <button type="button" onclick="AddWallet()" class="btn btn-success shadow rounded-2">
                ثبت
            </button>
        </div>
    </div>
</form>

<!-- اسکریپت شما بدون تغییر باقی می‌ماند، چون ID المنت همچنان SubSysId است -->
<script>

 function AddWallet() {
        var formData = {
            Name: $('#Name').val(),
            SubSysId: $('#SubSysId').val(), // این خط مقدار انتخاب شده از دراپ‌داون را می‌گیرد
            Balance: $('#Balance').val(),
            SaveDate: $('#SaveDate').val()
        };
         if (!formData.Name || formData.Name.trim() === "") {
            Swal.fire('هشدار', 'لطفاً نام کیف پول را وارد کنید.', 'warning');
            return;
        }
        if (formData.Balance === "" || formData.Balance === null) {
            Swal.fire('هشدار', 'لطفاً موجودی را وارد کنید.', 'warning');
            return;
        }

        $.ajax({
            type: "POST",
            url: "/Wallet/Create",
            data: formData,
            success: function (response) {
                if (response.state > 0 && response.state < 1000) {
                    swal.fire({
                        title: 'موفق!',
                        html: response.message,
                        icon: 'success',
                        confirmButtonText: 'تایید'
                    }).then(function () {
                        window.location.reload();
                    });
                } else {
                    swal.fire({
                        title: 'خطا!',
                        html: response.message,
                        icon: 'error',
                        confirmButtonText: 'تایید'
                    });
                }
            },
            error: function (xhr, ajaxOptions, thrownError) {
                swal.fire({
                   title: 'خطا!',
                   html: 'خطا در برقراری ارتباط با سرور',
                   icon: 'error',
                   confirmButtonText: 'تایید'
                });
            }
        });
    }

</script>